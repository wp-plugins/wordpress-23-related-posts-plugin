
(function($){var template_eval=function(template,vars){$.each(vars,function(k,v){template=template.replace(new RegExp('{{ *'+k+' *}}'),v);});return template;};$(function(){var wrap=$('#wp_rp_statistics_wrap'),dashboard_url=$('#wp_rp_dashboard_url').val(),blog_id=$('#wp_rp_blog_id').val(),auth_key=$('#wp_rp_auth_key').val(),li_template='<li class="{{class}}"><h4>{{ title}}<span>{{range}}</span></h4><p class="num"></p><div class="overlay"><p>{{description}}</p></div></li>';req_timeout=null,update_interval=null,update_interval_sec=2000,update_interval_error_sec=30000,updating=false,ul=null,set_update_interval=function(interval){if(!interval){interval=update_interval_sec;}
clearInterval(update_interval);if(interval>0){update_interval=setInterval(update_dashboard,interval);}},display_error=function(hidden){var wrap=$('#wp_rp_statistics_wrap');if(!hidden){wrap.find('.unavailable').slideDown();}
set_update_interval(update_interval_error_sec);updating=false;},create_dashboard=function(){ul=$('<ul class="statistics" />');wrap.find('.unavailable').slideUp();ul.append(template_eval(li_template,{'class':'ctr',title:'click-through rate',description:'Number of clicks on a Related Post divided by the number of times the post was shown to readers. Tip: Using thumbnails will generally rise Click-through Rates.',range:'last 30 days',}));ul.append(template_eval(li_template,{'class':'pageviews',title:'page views',description:'Number of times the page (usually post) was loaded to readers.',range:'last 30 days',}));ul.append(template_eval(li_template,{'class':'clicks',title:'clicks',description:'Number of times a reader has clicked on one of the Related Posts.',range:'last 30 days',}));ul.hide();wrap.append(ul);ul.slideDown();},update_dashboard=function(first){if(updating){return;}
updating=true;req_timeout=setTimeout(function(){display_error(!first);},2000);$.getJSON(dashboard_url+'pageviews/?callback=?',{blog_id:blog_id,auth_key:auth_key},function(response){clearTimeout(req_timeout);if(!response||response.status!=='ok'||!response.data){display_error(!first);return;}
if(!ul){create_dashboard();}
set_update_interval(response.data.update_interval);ul.find('.ctr .num').html(response.data.ctr+'%');ul.find('.pageviews .num').html(response.data.pageviews);ul.find('.clicks .num').html(response.data.clicks);updating=false;});};if(dashboard_url){if(!blog_id||!auth_key){display_error();return;}
update_dashboard(true);update_interval=setInterval(update_dashboard,2000);}
var em=$("<em>(don't forget to save the changes)</em>").css({'display':'none','color':'red'}),span=$('#wp_rp_statistics_wrap .option-enable span'),label=span.parent(),label_position=label.position(),img=label.parent().find('img'),img_position=img.position(),ctr_checkbox=label.find('input'),initial_ctr_checkbox_value=ctr_checkbox[0].checked;label.css({'position':'absolute','top':label_position.top+'px','left':label_position.left+'px'});img.css({'position':'absolute','top':img_position.top+'px','left':img_position.left+'px'});span.append(em);ctr_checkbox.change(function(){if(this.checked!==initial_ctr_checkbox_value){em.show();}else{em.hide();}});});}(jQuery));